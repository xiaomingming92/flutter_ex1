# 开发环境调试优化方案

## 问题描述

当前登录认证流程过于复杂，在开发环境调试 `splash_static_widget.dart` 或 `ad_widget.dart` 时需要中断多处跳转逻辑，开发体验不佳。

## 解决方案

### 1. 环境变量控制的调试模式

在 `.env` 文件中添加调试开关：

```env
# 开发环境调试开关
DEV_DEBUG_SPLASH=false
# DEV_DEBUG_SPLASH=true 开启调试模式，禁止自动跳转
```

### 2. 修改 SplashIntentController

```dart
// 在 SplashIntentController 中添加调试模式检查

@override
void onInit() {
  super.onInit(); 
  // 判断展示模式
  _decideSplashMode();
}

Future<void> _decideSplashMode() async {
  final mode = await _computeSplashMode();
  this.mode.value = mode;
  
  // 检查是否开启调试模式
  final isDebugMode = Env.getBool('DEV_DEBUG_SPLASH', defaultValue: false);
  if (isDebugMode) {
    // 调试模式：不自动跳转，允许手动控制
    canNavigate.value = false;
    return;
  }
  
  // 正常模式：根据模式决定何时允许跳转
  if (mode == SplashMode.static) {
    _waitForAuthCheck();
  } else {
    _startAdCountdown();
  }
}

// 添加手动跳转方法供调试使用
void manualNavigate() {
  _navigateToTarget();
}
```

### 3. 修改 SplashPage

```dart
@override
Widget build(BuildContext context) {
  final isDebugMode = Env.getBool('DEV_DEBUG_SPLASH', defaultValue: false);
  
  return Scaffold(
    body: Stack(
      children: [
        // 正常的启动页内容
        Obx(() {
          switch(controller.mode.value) {
            case SplashMode.static:
              return FirstScreenStatic();
            case SplashMode.ad:
              return AdWidget();
          }
        }),
        
        // 调试模式下显示控制按钮
        if (isDebugMode) Positioned(
          bottom: 50,
          left: 0,
          right: 0,
          child: Column(
            children: [
              ElevatedButton(
                onPressed: () => controller.manualNavigate(),
                child: const Text('手动跳转'),
              ),
              const SizedBox(height: 20),
              ElevatedButton(
                onPressed: () => controller.mode.value = SplashMode.static,
                child: const Text('切换到静态页'),
              ),
              ElevatedButton(
                onPressed: () => controller.mode.value = SplashMode.ad,
                child: const Text('切换到广告页'),
              ),
            ],
          ),
        ),
      ],
    ),
  );
}
```

## 使用方法

1. **开启调试模式**：在 `.env` 文件中设置 `DEV_DEBUG_SPLASH=true`
2. **运行应用**：启动页将显示但不会自动跳转
3. **调试组件**：可以自由调试 `splash_static_widget.dart` 或 `ad_widget.dart`
4. **手动控制**：使用页面底部的按钮切换页面或手动触发跳转
5. **关闭调试**：设置 `DEV_DEBUG_SPLASH=false` 恢复正常流程

## 优势

1. **无需修改代码**：通过环境变量控制，无需频繁注释/取消注释代码
2. **不影响生产**：仅在开发环境生效，生产环境不受影响
3. **灵活控制**：可以随时切换页面模式，方便对比调试
4. **保留流程**：手动跳转后仍保持正常的认证流程

## 注意事项

1. 确保 `.env` 文件已添加到 `.gitignore`（如果包含敏感信息）
2. 开发完成后记得关闭调试模式
3. 定期检查调试代码，避免意外提交到生产环境